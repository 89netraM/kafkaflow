"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[9202],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>m});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function d(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?d(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):d(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},d=Object.keys(e);for(r=0;r<d.length;r++)t=d[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(r=0;r<d.length;r++)t=d[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var o=r.createContext({}),s=function(e){var n=r.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},c=function(e){var n=s(e.components);return r.createElement(o.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},u=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,d=e.originalType,o=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=s(t),m=a,f=u["".concat(o,".").concat(m)]||u[m]||p[m]||d;return t?r.createElement(f,l(l({ref:n},c),{},{components:t})):r.createElement(f,l({ref:n},c))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var d=t.length,l=new Array(d);l[0]=u;var i={};for(var o in n)hasOwnProperty.call(n,o)&&(i[o]=n[o]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var s=2;s<d;s++)l[s]=t[s];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}u.displayName="MDXCreateElement"},5454:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>d,metadata:()=>i,toc:()=>s});var r=t(7462),a=(t(7294),t(3905));const d={sidebar_position:2},l="Typed Handler Middleware",i={unversionedId:"guides/middlewares/typed-handler-middleware",id:"guides/middlewares/typed-handler-middleware",title:"Typed Handler Middleware",description:"In this section, we will learn how to use the Typed Handler middleware.",source:"@site/docs/guides/middlewares/typed-handler-middleware.md",sourceDirName:"guides/middlewares",slug:"/guides/middlewares/typed-handler-middleware",permalink:"/kafkaflow/docs/guides/middlewares/typed-handler-middleware",draft:!1,editUrl:"https://github.com/farfetch/kafkaflow/tree/master/website/docs/guides/middlewares/typed-handler-middleware.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Middleware Introduction",permalink:"/kafkaflow/docs/guides/middlewares/"},next:{title:"Serializer Middleware",permalink:"/kafkaflow/docs/guides/middlewares/serializer-middleware"}},o={},s=[{value:"Configure Typed Handler",id:"configure-typed-handler",level:2},{value:"Create a Message Handler",id:"create-a-message-handler",level:2},{value:"Configuring Handler Lifetime",id:"configuring-handler-lifetime",level:2},{value:"Handling No Handler Found event",id:"handling-no-handler-found-event",level:2}],c={toc:s};function p(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,r.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"typed-handler-middleware"},"Typed Handler Middleware"),(0,a.kt)("p",null,"In this section, we will learn how to use the Typed Handler middleware."),(0,a.kt)("p",null,"The Typed Handler Middleware allows you to execute different handlers depending on the message type. "),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Use it when the topic has different message types. ")),(0,a.kt)("p",null,"When a message with a given type arrives, the middleware will call the appropriate message handler for that message type. "),(0,a.kt)("h2",{id:"configure-typed-handler"},"Configure Typed Handler"),(0,a.kt)("p",null,"There are three ways to add handlers to a consumer:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"strong"},"AddHandler<HandlerType>()"),":")," adds one handler per call."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"strong"},"AddHandlers(IEnumerable<Type> handlers)"),":")," adds many handlers per call."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"strong"},"AddHandlersFromAssemblyOf<HandlerType>()"),":")," adds all classes on the given assembly type that implement the ",(0,a.kt)("inlineCode",{parentName:"li"},"IMessageHandler")," interface.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'services.AddKafka(kafka => kafka\n    .AddCluster(cluster => cluster\n        .WithBrokers(new[] { "localhost:9092" })\n        .AddConsumer(consumer => consumer\n            ...\n            .AddMiddlewares(middlewares => middlewares\n                ...\n                .AddTypedHandlers(handlers => handlers\n                    .WithHandlerLifetime(InstanceLifetime.Singleton)\n                    .AddHandler<ProductCreatedHandler>()\n                    // or\n                    .AddHandlers( ... )\n                    // or\n                    .AddHandlersFromAssemblyOf<ProductCreatedHandler>()\n                )\n            )\n        )\n    )\n);\n')),(0,a.kt)("h2",{id:"create-a-message-handler"},"Create a Message Handler"),(0,a.kt)("p",null,"A message handler can be created by implementing the ",(0,a.kt)("inlineCode",{parentName:"p"},"IMessageHandler<MessageType>")," interface. "),(0,a.kt)("p",null,"The handler's instance is created by the configured dependency injection container, any handler dependency will be injected through the constructor, and the instance lifetime can be configured in the configuration. "),(0,a.kt)("admonition",{type:"warning"},(0,a.kt)("p",{parentName:"admonition"},"If there's no handler defined for the arriving message, it will be ignored.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},"public class ProductCreatedHandler : IMessageHandler<ProductCreatedEvent>\n{\n    public Task Handle(IMessageContext context, ProductCreatedEvent message)\n    {\n        ...\n    }\n}\n")),(0,a.kt)("h2",{id:"configuring-handler-lifetime"},"Configuring Handler Lifetime"),(0,a.kt)("p",null,"The Handler lifetime can be configured to one of the following modes:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Singleton:")," A single class instance will be created for the entire application."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Scoped:")," A new class instance will be created for each scope."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Transient:")," A new class instance will be created every time it is requested.")),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"By default, the handler lifetime is Singleton.")),(0,a.kt)("h2",{id:"handling-no-handler-found-event"},"Handling No Handler Found event"),(0,a.kt)("p",null,"If there's no handler defined for the arriving message, it will be ignored."),(0,a.kt)("p",null,"It is possible to handle those events. As an example, the following code writes to the console when a message can't be handled."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'services.AddKafka(kafka => kafka\n    .AddCluster(cluster => cluster\n        .WithBrokers(new[] { "localhost:9092" })\n        .AddConsumer(consumer => consumer\n            ...\n            .AddMiddlewares(middlewares => middlewares\n                ...\n                .AddTypedHandlers(handlers => handlers\n                    .AddHandler<ProductCreatedHandler>()\n                    .WhenNoHandlerFound(context => \n                        Console.WriteLine("Message not handled > Partition: {0} | Offset: {1}",\n                            context.ConsumerContext.Partition,\n                            context.ConsumerContext.Offset)\n                        )\n                )\n            )\n        )\n    )\n);\n')))}p.isMDXComponent=!0}}]);